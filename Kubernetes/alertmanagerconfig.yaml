apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: main-rules-alert-config
  namespace: monitoring
  labels:
    release: kube-prometheus-stack 
spec: 
  route:
    receiver: 'default-receiver'
    group_by: ['alertname', 'cluster', 'service', 'severity'] 
    group_wait: 30s 
    group_interval: 5m 
    repeat_interval: 4h 
    routes:
    # Route for critical alerts
    - match:
        severity: critical
      receiver: 'critical-alerts'
      continue: true 

    # Route for warning alerts
    - match:
        severity: warning
      receiver: 'warning-alerts'
      continue: true

    # Route for security team-specific alerts
    - match:
        team: security 
      receiver: 'security-alerts' 
      continue: true

    # Route for critical alerts specific to 'core-serve' service
    - match:
        service: core-serve
        severity: critical
      receiver: 'core-serve-critical' 
      group_by: ['alertname', 'pod', 'instance'] 
      group_wait: 10s 
      repeat_interval: 1h 
  receivers:
  - name: 'default-receiver'
    # Default Email recipient
    emailConfigs:
      - to: 'adebunmi33@gmail.com' 
        from: 'adebunmi33@gmail.com' 
        sendResolved: true 
        html: true 
        smarthost: 'smtp.gmail.com:587' 
        smtp_auth_username: 'adebunmi33@gmail.com' 
        smtp_auth_password: 'njid zanu qmtl fyjx' 
  
  - name: 'critical-alerts'
    emailConfigs:
      - to: 'adebunmi33@gmail.com'
        from: 'adebunmi33@gmail.com'
        sendResolved: true
        html: true
        smarthost: 'smtp.gmail.com:587'
        smtp_auth_username: 'adebunmi33@gmail.com'
        smtp_auth_password: 'njid zanu qmtl fyjx'
  
  - name: 'warning-alerts'
    emailConfigs:
      - to: 'adebunmi33@gmail.com'
        from: 'adebunmi33@gmail.com'
        sendResolved: true
        html: true
        smarthost: 'smtp.gmail.com:587'
        smtp_auth_username: 'adebunmi33@gmail.com'
        smtp_auth_password: 'njid zanu qmtl fyjx'

  - name: 'security-alerts'
    emailConfigs:
      - to: 'adebunmi33@gmail.com'
        from: 'adebunmi33@gmail.com'
        sendResolved: true
        html: true
        smarthost: 'smtp.gmail.com:587'
        smtp_auth_username: 'adebunmi33@gmail.com'
        smtp_auth_password: 'njid zanu qmtl fyjx'

  - name: 'core-serve-critical'
    emailConfigs:
      - to: 'adebunmi33@gmail.com'
        from: 'adebunmi33@gmail.com'
        sendResolved: true
        html: true
        smarthost: 'smtp.gmail.com:587'
        smtp_auth_username: 'adebunmi33@gmail.com'
        smtp_auth_password: 'njid zanu qmtl fyjx'
