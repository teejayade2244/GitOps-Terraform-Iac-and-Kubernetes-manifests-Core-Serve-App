apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: main-rules-alert-config
  namespace: monitoring
  labels:
    release: kube-prometheus-stack 
spec: 
  route:
    receiver: 'default-receiver'
    groupBy: ['alertname', 'cluster', 'service', 'severity'] 
    groupWait: 30s 
    groupInterval: 5m 
    repeatInterval: 4h 
    routes:
    # Route for critical alerts
    - match:
        severity: critical
      receiver: 'critical-alerts'
      continue: true 

    # Route for warning alerts
    - match:
        severity: warning
      receiver: 'warning-alerts'
      continue: true

    # Route for security team-specific alerts
    - match:
        team: security 
      receiver: 'security-alerts' 
      continue: true

    # Route for critical alerts specific to 'core-serve' service
    - match:
        service: core-serve
        severity: critical
      receiver: 'core-serve-critical' 
      groupBy: ['alertname', 'pod', 'instance'] 
      groupWait: 10s 
      repeatInterval: 1h 
  receivers:
  - name: 'default-receiver'
    # Default Email recipient
    emailConfigs:
      - to: 'adebunmi33@gmail.com' 
        from: 'adebunmi33@gmail.com' 
        sendResolved: true 
        smarthost: 'smtp.gmail.com:587' 
        authUsername: 'adebunmi33@gmail.com'
        authPassword:
          name: smtp-secret
          key: password
  
  - name: 'critical-alerts'
    emailConfigs:
      - to: 'adebunmi33@gmail.com'
        from: 'adebunmi33@gmail.com'
        sendResolved: true
        smarthost: 'smtp.gmail.com:587'
        authUsername: 'adebunmi33@gmail.com'
        authPassword:
          name: smtp-secret
          key: password
  
  - name: 'warning-alerts'
    emailConfigs:
      - to: 'adebunmi33@gmail.com'
        from: 'adebunmi33@gmail.com'
        sendResolved: true
        smarthost: 'smtp.gmail.com:587'
        authUsername: 'adebunmi33@gmail.com'
        authPassword:
          name: smtp-secret
          key: password

  - name: 'security-alerts'
    emailConfigs:
      - to: 'adebunmi33@gmail.com'
        from: 'adebunmi33@gmail.com'
        sendResolved: true
        smarthost: 'smtp.gmail.com:587'
        authUsername: 'adebunmi33@gmail.com'
        authPassword:
          name: smtp-secret
          key: password

  - name: 'core-serve-critical'
    emailConfigs:
      - to: 'adebunmi33@gmail.com'
        from: 'adebunmi33@gmail.com'
        sendResolved: true
        smarthost: 'smtp.gmail.com:587'
        authUsername: 'adebunmi33@gmail.com'
        authPassword:
          name: smtp-secret
          key: password